#/usr/bin/env bash

humann2 \
    --input 'test-data/input_sequences.fasta' \
    -o 'humann2_output' \
    --annotation-gene-index 8 \
    --taxonomic-profile 'test-data/taxonomic_profile.tabular' \
    --metaphlan-options="-t rel_ab" \
    --nucleotide-database 'test-data/' \
    --protein-database 'test-data/' \
    --evalue '1' \
    --search-mode 'uniref50' \
    --prescreen-threshold '0.01' \
    --identity-threshold '50' \
    --translated-subject-coverage-threshold '50' \
    --translated-query-coverage-threshold '50' \
    --translated-alignment 'diamond' \
    --xipe 'off' \
    --minpath 'on' \
    --pick-frames 'on' \
    --gap-fill 'off' \
    --output-format 'tsv' \
    --output-max-decimals '10' \
    --output-basename 'humann2' \
    --pathways 'metacyc'

humann2_regroup_table \
    --input 'test-data/demo_genefamilies.tsv' \
    -o 'test-data/regrouped_gene_families_to_infogo1000.tsv' \
    --function 'sum' \
    --groups 'uniref90_infogo1000' \
    --ungrouped 'Y' \
    --protected 'Y'

humann2_regroup_table \
    --input 'test-data/demo_genefamilies.tsv' \
    -o 'test-data/regrouped_gene_families_to_ko.tsv' \
    --function 'mean' \
    --groups 'uniref90_ko' \
    --ungrouped 'Y' \
    --protected 'Y'

humann2_regroup_table \
    --input 'test-data/demo_genefamilies.tsv' \
    -o 'test-data/regrouped_gene_families_to_rxn.tsv' \
    --function 'sum' \
    --groups 'uniref90_rxn' \
    --ungrouped 'Y' \
    --protected 'Y'

humann2_renorm_table \
    --input 'test-data/demo_pathabundance.tsv' \
    -o 'test-data/cpm_community_renormalized_pathway_abundance.tsv' \
    --units 'cpm' \
    --mode 'community' \
    --special 'n'

humann2_renorm_table \
    --input 'test-data/demo_pathabundance.tsv' \
    -o 'test-data/relab_levelwise_renormalized_pathway_abundance.tsv' \
    --units 'relab' \
    --mode 'levelwise' \
    --special 'y'

mkdir join_table_tmp_dir
cp 'test-data/demo_pathabundance.tsv' join_table_tmp_dir
cp 'test-data/demo_pathcoverage.tsv' join_table_tmp_dir
humann2_join_tables \
    -i 'join_table_tmp_dir' \
    -o 'test-data/joined_pathway_coverage_abundance.tsv'
 
