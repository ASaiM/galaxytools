<tool id="humann2_rna_dna_norm" name="Combine metagenomic and metatranscriptomic HUMAnN2 data" version="0.6.1">
    <description></description>

    <macros>
        <import>humann2_macros.xml</import>
    </macros>

    <expand macro="requirements"/>
    <expand macro="stdio"/>

    <version_command>
<![CDATA[
    humann2_rna_dna_norm --version
]]>
    </version_command>

    <command><![CDATA[
        humann2_rna_dna_norm
            --input_dna $input_dna
            --input_rna $input_rna
            --output_basename "combined"
            $log_transform.test  
            #if $log_transform.test:
                --log_base $log_transform.log_base
            #end if
    ]]></command>

    <inputs>
        <param name="input_dna" type="data" format="tsv" label="Metagenomic table" 
            help="(--input_dna)"/>
        <param name="input_rna" type="data" format="tsv" label="Metatranscriptomic table" 
            help="(--input_rna)"/>

        <conditional name="log_transform">
            <param name='test' type='boolean' checked="false" 
                truevalue='--log_transform' falsevalue='' 
                label="Report log-transformed relative expression values?" 
                help="(--log_transform)"/>
            <when value="--log_transform">
                <param name="log_base" type="integer" min="0" max="10" value="2" 
                    label="Base for log transformation" help="(--log_base)"/>
            </when>
            <when value=""/>
        </conditional>        
    </inputs>

    <outputs>
        <data format="tsv" name="smoothed_dna" 
            from_work_dir="combined"
            label="Smoothed DNA data for ${on_string} (HUMAnN2)" />
        <data format="tsv" name="smoothed_rna" 
            from_work_dir="combined"
            label="Smoothed RNA data for ${on_string} (HUMAnN2)" />
        <data format="tsv" name="normalized_rna" 
            from_work_dir="combined"
            label="Normalized RNA data for ${on_string} (HUMAnN2)" />
    </outputs>

    <tests>
    </tests>

    <help><![CDATA[
        **What it does**

        This tool normalizes combined meta'omic sequencing data. 

        Given a DNA table and a RNA table, it produces smoothed RNA and DNA values as well as relative expression values. "Smoothing" means substituting a small value in place of a zero or missing value. The Witten-Bell smoothing procedure is used here.

        If working with stratified data, smoothing is carried out on the stratified values and then community totals are recomputed.

        The DNA and RNA columns must be 1:1 and in the same order. The units of the table should be count-like (for example, HUMAnN2 gene family abundance files).gene and pathway abundance tables.

        HUMAnN is a pipeline for efficiently and accuretly profiling the presence/absence and abundance of microbial pathways in a community from metagenomic or metatranscriptomic sequencing data. `Read more about the tool <http://huttenhower.sph.harvard.edu/humann2/manual>`_.

    ]]></help>

    <citations>
    </citations>
</tool>